{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://testboost.dev/schemas/impact-report.json",
  "title": "ImpactReport",
  "description": "JSON schema for TestBoost impact analysis reports (FR-009)",
  "type": "object",
  "required": ["version", "generated_at", "project_path", "git_ref", "summary", "impacts", "test_requirements"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version",
      "const": "1.0"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of report generation"
    },
    "project_path": {
      "type": "string",
      "description": "Absolute path to analyzed project"
    },
    "git_ref": {
      "type": "string",
      "description": "HEAD commit SHA at time of analysis"
    },
    "total_lines_changed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total lines in git diff"
    },
    "processing_time_seconds": {
      "type": "number",
      "minimum": 0,
      "description": "Analysis duration in seconds"
    },
    "summary": {
      "$ref": "#/definitions/Summary"
    },
    "impacts": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Impact"
      },
      "description": "List of identified code impacts"
    },
    "test_requirements": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/TestRequirement"
      },
      "description": "List of tests to generate"
    }
  },
  "definitions": {
    "Summary": {
      "type": "object",
      "required": ["total_impacts", "business_critical", "non_critical", "tests_to_generate"],
      "properties": {
        "total_impacts": {
          "type": "integer",
          "minimum": 0
        },
        "business_critical": {
          "type": "integer",
          "minimum": 0
        },
        "non_critical": {
          "type": "integer",
          "minimum": 0
        },
        "tests_to_generate": {
          "type": "integer",
          "minimum": 0
        },
        "by_test_type": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        }
      }
    },
    "Impact": {
      "type": "object",
      "required": ["id", "file_path", "category", "risk_level", "affected_components", "required_test_type", "change_summary"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^IMP-[0-9]+$",
          "description": "Unique impact identifier"
        },
        "file_path": {
          "type": "string",
          "description": "Relative path to changed file"
        },
        "category": {
          "$ref": "#/definitions/ChangeCategory"
        },
        "risk_level": {
          "$ref": "#/definitions/RiskLevel"
        },
        "affected_components": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 1,
          "description": "Classes/methods affected by this change"
        },
        "required_test_type": {
          "$ref": "#/definitions/TestType"
        },
        "change_summary": {
          "type": "string",
          "description": "Human-readable description of the change"
        },
        "diff_lines": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 0
          },
          "minItems": 2,
          "maxItems": 2,
          "description": "[start_line, end_line] in diff"
        },
        "is_bug_fix": {
          "type": "boolean",
          "default": false,
          "description": "Whether this change is a bug fix"
        }
      }
    },
    "TestRequirement": {
      "type": "object",
      "required": ["id", "impact_id", "test_type", "scenario_type", "description", "priority", "target_class"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^TEST-[0-9]+$",
          "description": "Unique test requirement identifier"
        },
        "impact_id": {
          "type": "string",
          "pattern": "^IMP-[0-9]+$",
          "description": "Reference to parent impact"
        },
        "test_type": {
          "$ref": "#/definitions/TestType"
        },
        "scenario_type": {
          "$ref": "#/definitions/ScenarioType"
        },
        "description": {
          "type": "string",
          "description": "What the test should verify"
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5,
          "description": "1 = highest priority"
        },
        "suggested_test_name": {
          "type": "string",
          "description": "Suggested method name for the test"
        },
        "target_class": {
          "type": "string",
          "description": "Fully qualified class under test"
        },
        "target_method": {
          "type": "string",
          "description": "Method under test (optional)"
        }
      }
    },
    "ChangeCategory": {
      "type": "string",
      "enum": [
        "business_rule",
        "endpoint",
        "dto",
        "query",
        "migration",
        "api_contract",
        "configuration",
        "test",
        "other"
      ]
    },
    "RiskLevel": {
      "type": "string",
      "enum": ["business_critical", "non_critical"]
    },
    "TestType": {
      "type": "string",
      "enum": ["unit", "controller", "data_layer", "integration", "contract"]
    },
    "ScenarioType": {
      "type": "string",
      "enum": ["nominal", "edge_case", "regression", "invariant"]
    }
  }
}
